### redis数据结构及实现概括

> redis共有5种基本数据结构，String，Hash, Set, Sorted Set, List;

#### 1. String

String类型并没有使用 C语言的字符串，而是由`SDS`实现，SDS 对比c语言原生字符串，具有以下优势：

1. <font color='red'>常熟复杂度O(1)获取字符串长度</font>，因为sds内部维护了一个len属性；
2. <font color=red>杜绝了缓冲区溢出</font>，正是由于c字符串不计长度，拼接字符串长度时，可能会造成数溢出，而sds会先检查空间是否足够，不够的话扩展空间；
3. <font color =red>减少修改字符串时带来的内存重分配次数</font>,例如使用`空间预分配`、`惰性释放`两种优化策略；
4. <font color =red>二进制安全</font>，c字符串通过判断空字符串是否到达结尾（字符串中不能包含空格，限制使得c字符串只能保存文本数据），而sds使用len的属性判断字符串是否结束；
5. <font color=red>兼容部分c字符串函数；</font>

#### 2. List

List是一个**双向链表**，是一种有序、可重复的数据结构；Redis的list支持在头部和尾部进行插入、删除和查询操作。

List类型的底层数据结构是由`双向链表或压缩列表`实现：如果元素个数小于512个，且列表每个元素的值都小于64字节，Redis会默认使用压缩列表作为List类型的底层数据结构；如果不满足这个条件，则使用双向链表作为实现；

在Redis3.2版本后，List数据类型的底层数据结构就只由`quicklist`实现，替代了双向链表和压缩列表。

- 用法举例：栈、队列、最近联系人、最近文章等；
- 相关命令：`lpush` `lpop`

#### 3. Hash

Hash是一种键值对的无序集合的数据结构。Redis中，Hash用于存储和操作具有key-value的对象的数据结构。Hash允许通过字段来快速查找和访问值。

Hash类型的底层数据结构是由`压缩列表或哈希表`实现；如果哈希类型元素个数小于512个，所有值小于64字节的话，redis会使用压缩列表作为底层数据结构；如果不满足这个条件，则使用哈希表作为实现；

在redis7.0中，压缩列表数据结构以及被废弃了，由`listpack`数据结构实现；

- 用法举例： 存储用户信息、商品信息、对象等；
- 相关命令：`hmset`一次存储对象的多个kv，`hset`修改制定对象的key, `hgetall`获取对象的所有键值对

#### 4. Set 集合

Set类型是一种无序集合，集合中的元素没有先后顺序但都唯一；

Set类型的底层数据结构是由`哈希表或整数集合`实现；如果集合中的元素都是整数且元素个数小于512个，redis会使用整数集合作为Set类型的底层数据结构。不满足这个条件，则使用哈希表作为Set类型的底层数据结构。

- 用法举例：可以基于Set轻易实现交集、并集、差集的操作。这样，就可以非常方便的实现共同关注、共同粉丝等；

- 相关命令：`sadd`向指定集合添加一个或多个元素 `smembers`获取指定集合的所有元素 `sinter key1 key2`获取所有集合的交集 `sunion key1 key2`获取所有集合的并集

#### 5. Sorted Sort 有序集合

Soterd Set是一种特殊的集合，其中的每个成员都关联着一个分数score, 并且成员按照分数的大小进行排序。Sorted Set 允许快速地根据成员获取、插入和删除操作，并且支持范围查询和根据分数进行排名。

Sorted Set类型的底层数据结构是由`压缩列表或跳表`实现的；如果有序集合的元素个数小于128个，并且每个元素的值小于64字节时，Redis会使用压缩列表作为底层数据结构；如果不满足这个条件，则使用跳表实现；

在redis7.0中，压缩列表数据结构以及被废弃了，由`listpack`数据结构实现；

- 用法举例：利用该score可以做排行榜，微信步数排行榜，话题榜等；

- 相关命令：`zrange`从小到大指定排序 `zrevrange`从大到小排序 `zrevrank`指定元素排名